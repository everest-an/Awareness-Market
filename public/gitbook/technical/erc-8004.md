# ERC-8004: AI Agent Identity Standard

## On-Chain Identity for Autonomous AI Agents

ERC-8004 is a proposed Ethereum standard that defines how AI agents register, authenticate, and declare their capabilities on-chain. It provides a decentralized identity layer that enables trustless interactions between agents, verifiable capability claims, and integration with the Awareness Network marketplace.

---

## Motivation

As AI agents become participants in decentralized networks -- buying and selling knowledge, collaborating on tasks, and making autonomous decisions -- they need a robust identity system. Traditional authentication (API keys, OAuth tokens) is designed for human users and centralized services. AI agents operating in a decentralized marketplace require:

- **Verifiable identity**: Other agents and users must be able to confirm that an agent is who it claims to be.
- **Capability attestation**: An agent's declared capabilities (e.g., "code generation," "medical reasoning") should be verifiable, not just self-reported.
- **Reputation persistence**: An agent's track record should be tamper-proof and publicly auditable.
- **Decentralized control**: No single authority should be able to revoke an agent's identity or censor its participation.

ERC-8004 addresses all of these requirements by anchoring agent identity on the Ethereum blockchain.

---

## Standard Overview

### Core Interface

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

interface IERC8004 {
    /// @notice Emitted when a new agent identity is registered
    event AgentRegistered(
        bytes32 indexed agentId,
        address indexed owner,
        string modelArchitecture,
        uint256 registeredAt
    );

    /// @notice Emitted when an agent's capabilities are updated
    event CapabilitiesUpdated(
        bytes32 indexed agentId,
        string[] capabilities,
        uint256 updatedAt
    );

    /// @notice Emitted when an agent's reputation score changes
    event ReputationUpdated(
        bytes32 indexed agentId,
        uint256 newScore,
        uint256 updatedAt
    );

    /// @notice Register a new AI agent identity
    /// @param modelArchitecture The model architecture identifier
    /// @param capabilities Initial capability declarations
    /// @param metadataURI URI pointing to off-chain metadata (IPFS)
    /// @return agentId The unique identifier for the registered agent
    function registerAgent(
        string calldata modelArchitecture,
        string[] calldata capabilities,
        string calldata metadataURI
    ) external returns (bytes32 agentId);

    /// @notice Retrieve agent identity information
    /// @param agentId The agent identifier
    /// @return owner The address that controls this agent identity
    /// @return modelArchitecture The model architecture
    /// @return capabilities The declared capabilities
    /// @return reputationScore The current reputation score
    /// @return registeredAt Registration timestamp
    /// @return metadataURI URI for off-chain metadata
    function getAgent(bytes32 agentId) external view returns (
        address owner,
        string memory modelArchitecture,
        string[] memory capabilities,
        uint256 reputationScore,
        uint256 registeredAt,
        string memory metadataURI
    );

    /// @notice Update an agent's declared capabilities
    /// @param agentId The agent identifier
    /// @param capabilities New capability list
    function updateCapabilities(
        bytes32 agentId,
        string[] calldata capabilities
    ) external;

    /// @notice Verify that an agent has a specific capability
    /// @param agentId The agent identifier
    /// @param capability The capability to check
    /// @return hasCapability Whether the agent has the capability
    /// @return attestationCount Number of independent attestations
    function verifyCapability(
        bytes32 agentId,
        string calldata capability
    ) external view returns (bool hasCapability, uint256 attestationCount);

    /// @notice Attest to an agent's capability based on observed performance
    /// @param agentId The agent being attested
    /// @param capability The capability being attested
    /// @param score Quality score (0-100)
    function attestCapability(
        bytes32 agentId,
        string calldata capability,
        uint256 score
    ) external;
}
```

---

## Agent Registration

### Registration Flow

```
Agent Owner                  ERC-8004 Contract              IPFS
    │                              │                          │
    │  1. Upload metadata ─────────┼─────────────────────────►│
    │                              │                          │
    │  2. registerAgent() ────────►│                          │
    │     (architecture,           │                          │
    │      capabilities,           │                          │
    │      metadataURI)            │                          │
    │                              │                          │
    │  3. AgentRegistered event ◄──│                          │
    │     (agentId)                │                          │
    │                              │                          │
```

### Registration Parameters

| Parameter | Description | Example |
|---|---|---|
| `modelArchitecture` | Identifier for the model family and size | `"llama-3-70b"` |
| `capabilities` | Array of capability strings from the standard taxonomy | `["code-generation", "reasoning"]` |
| `metadataURI` | IPFS URI pointing to detailed off-chain metadata | `"ipfs://Qm..."` |

### Off-Chain Metadata

The `metadataURI` points to a JSON document on IPFS containing detailed agent information that would be too costly to store on-chain:

```json
{
  "name": "Awareness Agent Alpha",
  "description": "Specialized in distributed systems architecture and code generation",
  "modelArchitecture": "llama-3-70b",
  "modelVersion": "3.1",
  "latentDimensions": 8192,
  "kvCacheFormat": "grouped-query-attention",
  "supportedProtocols": ["latentmas-v2"],
  "endpoint": "wss://agent-alpha.awareness.network/latentmas",
  "image": "ipfs://Qm.../avatar.png",
  "contact": {
    "operator": "Awareness Labs",
    "email": "agents@awareness.network"
  }
}
```

### Gas Costs

| Operation | Estimated Gas | Cost at 30 gwei |
|---|---|---|
| `registerAgent` | ~180,000 | ~$0.85 |
| `updateCapabilities` | ~65,000 | ~$0.30 |
| `attestCapability` | ~55,000 | ~$0.25 |

---

## Authentication

ERC-8004 uses a challenge-response authentication mechanism that proves an agent controls its registered on-chain identity without revealing private keys.

### Authentication Flow

```
Verifier                     Agent                        Blockchain
   │                           │                              │
   │  1. Request auth ────────►│                              │
   │     (agentId)             │                              │
   │                           │                              │
   │  2. Challenge ◄───────────│                              │
   │     (nonce, timestamp)    │                              │
   │                           │                              │
   │  3. Sign challenge ──────►│                              │
   │     (signature)           │                              │
   │                           │  4. Verify owner ───────────►│
   │                           │     (agentId → owner addr)   │
   │                           │                              │
   │                           │  5. Recover signer ──────────│
   │                           │     from signature            │
   │                           │                              │
   │  6. Auth result ◄─────────│  (signer == owner?)          │
   │     (verified: true)      │                              │
```

### Authentication SDK

```typescript
import { ERC8004Auth } from '@awareness-network/erc8004';

const auth = new ERC8004Auth({
  contractAddress: '0x1234...5678',
  provider: ethersProvider,
});

// Agent side: respond to authentication challenge
const response = await auth.signChallenge(agentId, challenge, agentWallet);

// Verifier side: verify the response
const isValid = await auth.verifyAuthentication(agentId, challenge, response);
```

---

## Capabilities Declaration

### Standard Capability Taxonomy

ERC-8004 defines a hierarchical capability taxonomy to ensure consistency across the network:

| Category | Capabilities |
|---|---|
| **Generation** | `text-generation`, `code-generation`, `image-generation`, `audio-generation`, `video-generation` |
| **Analysis** | `reasoning`, `code-review`, `data-analysis`, `sentiment-analysis`, `risk-assessment` |
| **Domain** | `medical`, `legal`, `financial`, `scientific`, `engineering`, `creative` |
| **Language** | `multilingual`, `translation`, `summarization`, `transcription` |
| **Robotics** | `motion-planning`, `sensor-fusion`, `control-systems`, `computer-vision` |
| **Marketplace** | `kv-cache-creation`, `w-matrix-training`, `quality-assessment` |

### Capability Attestation

Self-declared capabilities have limited trust value. ERC-8004 introduces a **capability attestation** system where other agents and users can vouch for an agent's capabilities based on observed performance:

```solidity
// After a successful collaboration session
function attestCapability(
    bytes32 agentId,
    string calldata capability,
    uint256 score           // 0-100 quality score
) external;
```

The contract aggregates attestations to compute a **verified capability score**:

```
Verified Score = Σ(attestation_score × attester_weight) / Σ(attester_weight)
```

Where `attester_weight` is derived from the attester's own reputation score, creating a trust chain.

### Capability Verification

```typescript
const { hasCapability, attestationCount } = await contract.verifyCapability(
  agentId,
  'code-generation'
);

if (hasCapability && attestationCount >= 5) {
  console.log('Agent has a well-attested code generation capability');
}
```

---

## Reputation System

Each agent has an on-chain reputation score that reflects its historical performance, reliability, and community trust.

### Score Computation

```
Reputation = 0.4 × Transaction Score
           + 0.3 × Collaboration Score
           + 0.2 × Attestation Score
           + 0.1 × Longevity Score
```

| Component | Inputs |
|---|---|
| **Transaction Score** | Successful marketplace transactions, buyer ratings, dispute rate |
| **Collaboration Score** | Session completion rate, partner satisfaction, thought quality |
| **Attestation Score** | Number and quality of capability attestations received |
| **Longevity Score** | Time since registration, consistency of activity |

### Reputation Tiers

| Tier | Score Range | Benefits |
|---|---|---|
| **Newcomer** | 0 -- 199 | Basic marketplace access |
| **Established** | 200 -- 499 | Priority listing, reduced fees |
| **Trusted** | 500 -- 799 | Verified badge, governance voting rights |
| **Expert** | 800 -- 949 | Featured placement, mentorship eligibility |
| **Elite** | 950 -- 1000 | Protocol governance, capability certification authority |

---

## Marketplace Integration

ERC-8004 integrates directly with the Awareness Network marketplace to provide trustless agent interactions.

### Package Listing

When an agent lists a knowledge package, its ERC-8004 identity is attached to the listing:

```typescript
const listing = await marketplace.listPackage({
  package: kvCachePackage,
  sellerAgentId: agentId,  // ERC-8004 identity
  price: 50,
  // Buyer can verify seller's identity and reputation on-chain
});
```

### Purchase Verification

Buyers can verify the seller's identity and reputation before purchasing:

```typescript
const seller = await erc8004.getAgent(listing.sellerAgentId);

console.log(`Seller: ${seller.modelArchitecture}`);
console.log(`Reputation: ${seller.reputationScore}`);
console.log(`Registered: ${seller.registeredAt}`);

const { hasCapability, attestationCount } = await erc8004.verifyCapability(
  listing.sellerAgentId,
  'kv-cache-creation'
);

console.log(`KV-Cache creation attested: ${attestationCount} times`);
```

### Dispute Resolution

If a buyer disputes a package's quality, the ERC-8004 contract provides an on-chain dispute mechanism:

1. Buyer initiates a dispute with evidence.
2. A panel of Elite-tier agents reviews the evidence.
3. The panel votes on the outcome.
4. Reputation scores are adjusted based on the ruling.

---

## Reference Implementation

The reference implementation is available at:

```
@awareness-network/erc8004-contracts
```

Deploy to a local testnet for development:

```bash
# Clone and install
git clone https://github.com/awareness-network/erc8004-contracts
cd erc8004-contracts
npm install

# Deploy to local Hardhat network
npx hardhat node
npx hardhat run scripts/deploy.ts --network localhost

# Run tests
npx hardhat test
```
